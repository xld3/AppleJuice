<!doctype html>
<html> 
    <head>
        <meta charset="utf-8"/>
        <title>高效数据页操作</title>
    <style>
        table{width:400px;border:solid 1px red}
        table tr:nth-child(odd){
            background-color:#782d10;
        }
    </style>
    </head>
    <body>
        <!--
            作者：宁波徐Ludan
            QQ:46589025
            微信号：46589025
            基于js、及ajax实现后端高效分页
            基本原理：
            如果是第一次加载，则从服务端取数据，然后存入本地数组或字面量对象。
            否则，直接从数组取相关数据。

            那么删除数据行的时候，则从相关数组里删除数据，然后更新分页
            本案例仅在于简单实现，具体要结合生产环境
        -->
<div id="pager"></div>
<script>
  
        var data=[
    {title:'titleA',id:'1'},
    {title:'titleB',id:'2'},
    {title:'titleC',id:'3'},
    {title:'titleD',id:'4'},
    {title:'titleE',id:'5'},
    {title:'titleF',id:'6'},
    {title:'titleG',id:'7'},
    {title:'titleH',id:'8'},
    {title:'titleI',id:'9'},
    {title:'titleJ',id:'10'},
    {title:'titleK',id:'11'},
    {title:'titleL',id:'12'},
    {title:'titleM',id:'13'},
    {title:'titleM',id:'14'},
    {title:'titleM',id:'15'},
    {title:'titleM',id:'16'},
    {title:'titleM',id:'17'},
    {title:'titleM',id:'18'},
    {title:'titleM',id:'19'},
    {title:'titleM',id:'20'},
    {title:'titleM',id:'21'},
    {title:'titleM',id:'22'}
]

var DataList={
    init:{
        dom:null,
        pageSize:10,
        currentPage:1,
        pageCount:3
    },
    data:data,
    
    //重绘
    Render:function(){

        var tbl="<table>";
        var pgsize=this.init.pageSize;
        if(this.data.length<pgsize)
            {
                pgsize=this.data.length;
            }

        var maxPageSize=this.init.currentPage*pgsize;
        if(this.init.currentPage*pgsize>=this.data.length){
            maxPageSize=this.data.length
        }

        for(var i=(this.init.currentPage-1)*pgsize;i<maxPageSize;i++){
            tbl+="<tr><td><button>删除</button></td><td>"+this.data[i].id+"</td><td>"+this.data[i].title+"</td></tr>";
        }
        tbl+="</table><div class='page'>";

        for(var i=1;i<=this.init.pageCount;i++){
            tbl+="<a href=\"#\">"+i+"</a>"
        }
        tbl+="</div>";
        this.init.dom.innerHTML=tbl;
        this.bind();
    },
    deleteItem:function(index){
        this.data.splice((this.init.currentPage-1)*this.init.pageSize+index,1);
        this.Render();
    },

    //更新数据
    //当要获取的数据条数大于当前页*pagesize,则从服务器更新数据
    update:function(page){
        if(page*this.init.pageSize>this.init.currentPage*this.init.pageSize){

            this.data.push({title:'titleA',id:'23'})
        }
    },
    setPageHTML:function(cpage){
        this.init.currentPage=cpage;
        this.Render();
    },
    bind:function(){

        //参见https://developer.mozilla.org/zh-CN/docs/Web/API/NodeList
        Array.prototype.forEach.call(document.querySelectorAll("table button"), function(item,index){
        item.addEventListener("click",function(event){
            DataList.deleteItem(index)
        },false)
        });

        Array.prototype.forEach.call(document.querySelectorAll(".page a"), function(item,index){
        item.addEventListener("click",function(event){
            DataList.update(item.innerHTML);
            DataList.setPageHTML(item.innerHTML);
        },false)
        });
    }

}



</script>
<script>
    (function(){
    DataList.init.dom=document.getElementById("pager");
   // Pager.init({dom:document.getElementById("pager")});
    DataList.Render();
})()
</script>
    </body>
</html>
